## Values

import os
import requests
import json
import csv
from tqdm import tqdm  # Import the tqdm library for the progress bar

# Define the URL pattern
base_url = "http://api.kolada.se/v2/data/municipality/{ID}/year/{YEAR}"

# Create the "Data" subfolder if it doesn't exist
data_folder = "Data"
os.makedirs(data_folder, exist_ok=True)

# Read data from the input CSV file (assuming it's named 'input.csv')
with open('input.csv', 'r') as csvfile:
    reader = csv.DictReader(csvfile)
    total_rows = sum(1 for _ in reader)  # Get the total number of rows

    # Reset the CSV file pointer to the beginning
    csvfile.seek(0)
    next(reader)  # Skip the header row

    # Initialize the progress bar
    progress_bar = tqdm(total=total_rows, desc="Processing", unit="row")

    for row in reader:
        # Extract ID and YEAR from each row
        ID = row['ID']
        YEAR = row['YEAR']

        # Construct the complete URL
        url = base_url.format(ID=ID, YEAR=YEAR)

        # Fetch data from the URL
        response = requests.get(url)

        # Save the JSON response to a file in the "Data" subfolder
        output_filename = os.path.join(data_folder, f"{ID}_{YEAR}.json")
        with open(output_filename, 'w') as jsonfile:
            json.dump(response.json(), jsonfile, indent=4)

        # Update the progress bar
        progress_bar.update(1)

    # Close the progress bar
    progress_bar.close()

    print(f"Data for all rows saved to the '{data_folder}' subfolder")




# Details
import os
import csv
import json
import requests
from tqdm import tqdm

# Define the base URL
BASE_URL = "http://api.kolada.se/v2/kpi?id={}&per_page=1"

# Create the subfolder if it doesn't exist
subfolder = "KPI detail Data"
os.makedirs(subfolder, exist_ok=True)

# Read IDs from the CSV file
csv_file = "KPI_Input.csv"
with open(csv_file, "r") as f:
    reader = csv.DictReader(f)
    total_rows = sum(1 for _ in reader)  # Count the total number of rows

# Initialize the progress bar
with tqdm(total=total_rows, desc="Fetching data", unit="row") as pbar:
    # Read IDs and fetch data
    with open(csv_file, "r") as f:
        reader = csv.DictReader(f)
        for row in reader:
            kpi_id = row["ID"]
            url = BASE_URL.format(kpi_id)

            # Fetch JSON data
            try:
                response = requests.get(url)
                response.raise_for_status()
                data = response.json()

                # Save JSON data to a file with a unique filename
                output_file = os.path.join(subfolder, f"{kpi_id}.json")
                with open(output_file, "w") as json_file:
                    json.dump(data, json_file, indent=4)

            except requests.RequestException as e:
                print(f"Error fetching data for ID {kpi_id}: {e}")

            # Update progress bar
            pbar.update(1)

print("Data collection complete!")
